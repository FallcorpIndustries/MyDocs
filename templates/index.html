<!-- templates/index.html -->

{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- Upload Files Section -->
    <div class="col-12 mb-4">
        <h2>Upload Files</h2>
        <div class="row">
            <!-- Upload Document Form -->
            <div class="col-md-6">
                <form action="{{ url_for('upload_document') }}" method="post" enctype="multipart/form-data" class="upload-document-form" aria-label="Upload Document">
                    <div class="mb-3">
                        <label for="document" class="form-label">Choose Document (TXT, PDF, DOCX)</label>
                        <input class="form-control" type="file" id="document" name="document" accept=".txt,.pdf,.docx" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Upload Document</button>
                </form>
            </div>
            <!-- Upload Image Form -->
            <div class="col-md-6">
                <form action="{{ url_for('upload_image') }}" method="post" enctype="multipart/form-data" class="upload-image-form" aria-label="Upload Image">
                    <div class="mb-3">
                        <label for="image" class="form-label">Choose Image (PNG, JPG, JPEG, BMP, GIF)</label>
                        <input class="form-control" type="file" id="image" name="image" accept=".png,.jpg,.jpeg,.bmp,.gif" required>
                    </div>
                    <button type="submit" class="btn btn-success">Upload Image</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Uploaded Items Section -->
    <div class="col-12 mb-4">
        <h2>Uploaded Items</h2>
        {% if history %}
            <div class="list-group">
                {% for item in history %}
                    {% if item.type == 'Document' %}
                        <div class="list-group-item uploaded-item" data-index="{{ loop.index0 }}" tabindex="0" aria-label="Uploaded Document">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">Document: {{ item.filename }}</h5>
                                <div>
                                    <!-- Assign a unique ID to audio container for each item -->
                                    <div id="audio-container-{{ loop.index0 }}" class="d-inline"></div>
                                    <form action="{{ url_for('summarize_document_route', index=loop.index0) }}" method="post" class="d-inline summarize-document-form" aria-label="Summarize Document">
                                        <button type="submit" class="btn btn-warning btn-sm me-2" aria-label="Summarize Document">Summarize</button>
                                    </form>
                                    <form action="{{ url_for('generate_audio_route', index=loop.index0) }}" method="post" class="d-inline generate-audio-form" aria-label="Generate Audio for Document">
                                        <button type="submit" class="btn btn-info btn-sm me-2" aria-label="Generate Audio for Document">Generate Audio</button>
                                    </form>
                                    <form action="{{ url_for('delete_history_item', index=loop.index0) }}" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-danger btn-sm" aria-label="Delete Document">Delete</button>
                                    </form>
                                </div>
                            </div>
                            {% if item.audios %}
                                <div class="mt-3">
                                    <ul class="list-group">
                                        {% for audio in item.audios %}
                                            <li class="list-group-item">
                                                {{ audio.description }}
                                                <audio controls class="mt-2 w-100">
                                                    <source src="{{ url_for('static', filename='audio/' + audio.filename) }}" type="audio/wav">
                                                    Your browser does not support the audio element.
                                                </audio>
                                                
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                        </div>
                    {% elif item.type == 'Image' %}
                        <div class="list-group-item uploaded-item" data-index="{{ loop.index0 }}" tabindex="0" aria-label="Uploaded Image">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">Image: {{ item.filename }}</h5>
                                <div>
                                    <form action="{{ url_for('delete_history_item', index=loop.index0) }}" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-danger btn-sm" aria-label="Delete Image">Delete</button>
                                    </form>
                                </div>
                            </div>
                            <img src="{{ url_for('static', filename='images/' + item.filename) }}" alt="Uploaded Image: {{ item.filename }}" class="img-fluid mt-2 mb-3">
                            <p>{{ item.description }}</p>
                            {% if item.audios %}
                                <div class="mt-3">
                                    <ul class="list-group">
                                        {% for audio in item.audios %}
                                            <li class="list-group-item">
                                                {{ audio.description }}
                                                <audio controls class="mt-2 w-100">
                                                    <source src="{{ url_for('static', filename='audio/' + audio.filename) }}" type="audio/wav">
                                                    Your browser does not support the audio element.
                                                </audio>
                                                <form action="{{ url_for('delete_history_item', index=loop.index0) }}" method="post" class="d-inline">
                                                    <button type="submit" class="btn btn-danger btn-sm mt-2" aria-label="Delete Audio">Delete Audio</button>
                                                </form>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% else %}
            <p>No items to display. Upload a document or image to get started.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
